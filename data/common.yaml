---
rundeck::admin_policies:
  - description: 'Admin, all access'
    context:
      project: '.*'
    for:
      resource:
        - allow: '*'
      adhoc:
        - allow: '*'
      job:
        - allow: '*'
      node:
        - allow: '*'
    by:
      - group:
          - 'admin'

  - description: 'Admin, all access'
    context:
      application: 'rundeck'
    for:
      resource:
        - allow: '*'
      project:
        - allow: '*'
      storage:
        - allow: '*'
    by:
      - group:
          - 'admin'

rundeck::api_policies:
  - description: 'API project level access control'
    context:
      project: '.*'
    for:
      resource:
        - equals:
            kind: 'job'
          allow:
            - 'create'
            - 'delete'
        - equals:
            kind: 'node'
          allow:
            - 'read'
            - 'create'
            - 'update'
            - 'refresh'
        - equals:
            kind: 'event'
          allow:
            - 'read'
            - 'create'
      adhoc:
        - allow:
            - 'read'
            - 'run'
            - 'kill'
      job:
        - allow:
            - 'create'
            - 'read'
            - 'update'
            - 'delete'
            - 'run'
            - 'kill'
      node:
        - allow:
            - 'read'
            - 'run'
    by:
      - group:
          - 'api_token_group'

  - description: 'API Application level access control'
    context:
      application: 'rundeck'
    for:
      resource:
        - equals:
            kind: 'system'
          allow:
            - 'read'
      project:
        - match:
            name: '.*'
          allow:
            - 'read'
      storage:
        - match:
            path: '(keys|keys/.*)'
          allow: '*'
    by:
      - group:
          - 'api_token_group'

rundeck::auth_config:
  file:
    auth_flag: 'required'
    jaas_config:
      file: '/etc/rundeck/realm.properties'
    realm_config:
      admin_user: 'admin'
      admin_password: 'admin'
      auth_users: {}

rundeck::framework_config:
  framework.server.name: "%{facts.networking.fqdn}"
  framework.server.hostname: "%{facts.networking.hostname}"
  framework.server.port: '4440'
  framework.server.url: "http://%{facts.networking.fqdn}:4440"
  framework.projects.dir: '/var/lib/rundeck/projects'
  framework.etc.dir: '/etc/rundeck'
  framework.var.dir: '/var/lib/rundeck/var'
  framework.tmp.dir: '/var/lib/rundeck/var/tmp'
  framework.logs.dir: '/var/lib/rundeck/logs'
  framework.libext.dir: '/var/lib/rundeck/libext'
  framework.ssh.keypath: '/var/lib/rundeck/.ssh/id_rsa'
  framework.ssh.user: 'rundeck'
  framework.ssh.timeout: '0'
  rdeck.base: '/var/lib/rundeck'

rundeck::project_config:
  project.dir: '/var/lib/rundeck/projects/${project.name}'
  project.etc.dir: '/var/lib/rundeck/projects/${project.name}/etc'
  project.resources.file: '/var/lib/rundeck/projects/${project.name}/etc/resources.xml'

rundeck::database_config:
  url: 'jdbc:h2:file:/var/lib/rundeck/data/rundeckdb'

rundeck::key_storage_config:
  - type: 'db'
    path: 'keys'
