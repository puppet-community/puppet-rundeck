---
rundeck::admin_policies:
  - description: 'Admin, all access'
    context:
      project: '.*'
    for:
      resource:
        - allow: '*'
      adhoc:
        - allow: '*'
      job:
        - allow: '*'
      node:
        - allow: '*'
    by:
      - group:
          - 'admin'

  - description: 'Admin, all access'
    context:
      application: 'rundeck'
    for:
      resource:
        - allow: '*'
      project:
        - allow: '*'
      storage:
        - allow: '*'
    by:
      - group:
          - 'admin'

rundeck::auth_config:
  file:
    admin_user: 'admin'
    admin_password: 'admin'
    auth_users: {}
    realm_file: '/etc/rundeck/realm.properties'

rundeck::framework_config:
  framework.server.name: "%{facts.networking.fqdn}"
  framework.server.hostname: "%{facts.networking.hostname}"
  framework.server.port: '4440'
  framework.server.url: "http://%{facts.networking.fqdn}:4440"
  framework.projects.dir: '/var/lib/rundeck/projects'
  framework.etc.dir: '/etc/rundeck'
  framework.var.dir: '/var/lib/rundeck/var'
  framework.tmp.dir: '/var/lib/rundeck/var/tmp'
  framework.logs.dir: '/var/lib/rundeck/logs'
  framework.libext.dir: '/var/lib/rundeck/libext'
  framework.ssh.keypath: '/var/lib/rundeck/.ssh/id_rsa'
  framework.ssh.user: 'rundeck'
  framework.ssh.timeout: '0'
  rdeck.base: '/var/lib/rundeck'
  rundeck.server.uuid: "fqdn_uuid(%{facts.networking.fqdn})"

rundeck::file_keystorage_dir: "%{lookup('rundeck::framework_config.framework.var.dir')}/storage"

rundeck::security_config:
  useHMacRequestTokens: true
  apiCookieAccess: true

rundeck::database_config:
  type: 'h2'
  dbCreate: 'update'
  url: 'jdbc:h2:file:/var/lib/rundeck/data/rundeckdb'
  driverClassName: ''
  username: ''
  password: ''
  dialect: ''
  enable_h2_logs: 'on'

rundeck::key_storage_config:
  - type: 'file'
    path: '/'
    config:
      baseDir: "%{lookup('file_keystorage_dir')}"

rundeck::preauthenticated_config:
  enabled: false
  attributeName: 'REMOTE_USER_GROUPS'
  delimiter: ':'
  userNameHeader: 'X-Forwarded-Uuid'
  userRolesHeader: 'X-Forwarded-Roles'
  redirectLogout: false
  redirectUrl: '/oauth2/sign_in'

rundeck::keystore_password: 'adminadmin'
rundeck::truststore_password: 'adminadmin'
rundeck::rdeck_base: '/var/lib/rundeck'
